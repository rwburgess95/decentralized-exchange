{"ast":null,"code":"import _slicedToArray from \"/Users/raymondburgess/Dapps/blockchain-developer-bootcamp-v2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"/Users/raymondburgess/Dapps/blockchain-developer-bootcamp-v2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport { get, groupBy, reject, maxBy, minBy } from 'lodash';\nimport { createSelector } from 'reselect';\nimport moment from 'moment';\nimport { ETHER_ADDRESS, GREEN, RED, tokens, ether, formatBalance } from '../helpers';\n\nvar account = function account(state) {\n  return get(state, 'web3.account');\n};\n\nexport var accountSelector = createSelector(account, function (a) {\n  return a;\n});\n\nvar web3 = function web3(state) {\n  return get(state, 'web3.connection');\n};\n\nexport var web3Selector = createSelector(web3, function (w) {\n  return w;\n});\n\nvar tokenLoaded = function tokenLoaded(state) {\n  return get(state, 'token.loaded', false);\n};\n\nexport var tokenLoadedSelector = createSelector(tokenLoaded, function (tl) {\n  return tl;\n});\n\nvar token = function token(state) {\n  return get(state, 'token.connection');\n};\n\nexport var tokenSelector = createSelector(token, function (t) {\n  return t;\n});\n\nvar exchangeLoaded = function exchangeLoaded(state) {\n  return get(state, 'exchange.loaded', false);\n};\n\nexport var exchangeLoadedSelector = createSelector(exchangeLoaded, function (el) {\n  return el;\n});\n\nvar exchange = function exchange(state) {\n  return get(state, 'exchange.connection');\n};\n\nexport var exchangeSelector = createSelector(exchange, function (e) {\n  return e;\n});\nexport var contractsLoadedSelector = createSelector(tokenLoaded, exchangeLoaded, function (tl, el) {\n  return tl && el;\n}); // All Orders\n\nvar allOrdersLoaded = function allOrdersLoaded(state) {\n  return get(state, 'exchange.allOrders.loaded', false);\n};\n\nvar allOrders = function allOrders(state) {\n  return get(state, 'exchange.allOrders.data', []);\n}; // Cancelled orders\n\n\nvar cancelledOrdersLoaded = function cancelledOrdersLoaded(state) {\n  return get(state, 'exchange.cancelledOrders.loaded', false);\n};\n\nexport var cancelledOrdersLoadedSelector = createSelector(cancelledOrdersLoaded, function (loaded) {\n  return loaded;\n});\n\nvar cancelledOrders = function cancelledOrders(state) {\n  return get(state, 'exchange.cancelledOrders.data', []);\n};\n\nexport var cancelledOrdersSelector = createSelector(cancelledOrders, function (o) {\n  return o;\n}); // Filled Orders\n\nvar filledOrdersLoaded = function filledOrdersLoaded(state) {\n  return get(state, 'exchange.filledOrders.loaded', false);\n};\n\nexport var filledOrdersLoadedSelector = createSelector(filledOrdersLoaded, function (loaded) {\n  return loaded;\n});\n\nvar filledOrders = function filledOrders(state) {\n  return get(state, 'exchange.filledOrders.data', []);\n};\n\nexport var filledOrdersSelector = createSelector(filledOrders, function (orders) {\n  // Sort orders by date ascending for price comparison\n  orders = orders.sort(function (a, b) {\n    return a.timestamp - b.timestamp;\n  }); // Decorate the orders\n\n  orders = decorateFilledOrders(orders); // Sort orders by date descending for display\n\n  orders = orders.sort(function (a, b) {\n    return b.timestamp - a.timestamp;\n  });\n  return orders;\n});\n\nvar decorateFilledOrders = function decorateFilledOrders(orders) {\n  // Track previous order to compare history\n  var previousOrder = orders[0];\n  return orders.map(function (order) {\n    order = decorateOrder(order);\n    order = decorateFilledOrder(order, previousOrder);\n    previousOrder = order; // Update the previous order once it's decorated\n\n    return order;\n  });\n};\n\nvar decorateOrder = function decorateOrder(order) {\n  var etherAmount;\n  var tokenAmount;\n\n  if (order.tokenGive === ETHER_ADDRESS) {\n    etherAmount = order.amountGive;\n    tokenAmount = order.amountGet;\n  } else {\n    etherAmount = order.amountGet;\n    tokenAmount = order.amountGive;\n  } // Calculate token price to 5 decimal places\n\n\n  var precision = 100000;\n  var tokenPrice = etherAmount / tokenAmount;\n  tokenPrice = Math.round(tokenPrice * precision) / precision;\n  return _objectSpread(_objectSpread({}, order), {}, {\n    etherAmount: ether(etherAmount),\n    tokenAmount: tokens(tokenAmount),\n    tokenPrice: tokenPrice,\n    formattedTimestamp: moment.unix(order.timestamp).format('h:mm:ss a M/D')\n  });\n};\n\nvar decorateFilledOrder = function decorateFilledOrder(order, previousOrder) {\n  return _objectSpread(_objectSpread({}, order), {}, {\n    tokenPriceClass: tokenPriceClass(order.tokenPrice, order.id, previousOrder)\n  });\n};\n\nvar tokenPriceClass = function tokenPriceClass(tokenPrice, orderId, previousOrder) {\n  // Show green price if only one order exists\n  if (previousOrder.id === orderId) {\n    return GREEN;\n  } // Show green price if order price higher than previous order\n  // Show red price if order price lower than previous order\n\n\n  if (previousOrder.tokenPrice <= tokenPrice) {\n    return GREEN; // success\n  } else {\n      return RED; // danger\n    }\n};\n\nvar openOrders = function openOrders(state) {\n  var all = allOrders(state);\n  var filled = filledOrders(state);\n  var cancelled = cancelledOrders(state);\n  var openOrders = reject(all, function (order) {\n    var orderFilled = filled.some(function (o) {\n      return o.id === order.id;\n    });\n    var orderCancelled = cancelled.some(function (o) {\n      return o.id === order.id;\n    });\n    return orderFilled || orderCancelled;\n  });\n  return openOrders;\n};\n\nvar orderBookLoaded = function orderBookLoaded(state) {\n  return cancelledOrdersLoaded(state) && filledOrdersLoaded(state) && allOrdersLoaded(state);\n};\n\nexport var orderBookLoadedSelector = createSelector(orderBookLoaded, function (loaded) {\n  return loaded;\n}); // Create the order book\n\nexport var orderBookSelector = createSelector(openOrders, function (orders) {\n  // Decorate orders\n  orders = decorateOrderBookOrders(orders); // Group orders by \"orderType\"\n\n  orders = groupBy(orders, 'orderType'); // Fetch buy orders\n\n  var buyOrders = get(orders, 'buy', []); // Sort buy orders by token price\n\n  orders = _objectSpread(_objectSpread({}, orders), {}, {\n    buyOrders: buyOrders.sort(function (a, b) {\n      return b.tokenPrice - a.tokenPrice;\n    })\n  }); // Fetch sell orders\n\n  var sellOrders = get(orders, 'sell', []); // Sort sell orders by token price\n\n  orders = _objectSpread(_objectSpread({}, orders), {}, {\n    sellOrders: sellOrders.sort(function (a, b) {\n      return b.tokenPrice - a.tokenPrice;\n    })\n  });\n  return orders;\n});\n\nvar decorateOrderBookOrders = function decorateOrderBookOrders(orders) {\n  return orders.map(function (order) {\n    order = decorateOrder(order);\n    order = decorateOrderBookOrder(order);\n    return order;\n  });\n};\n\nvar decorateOrderBookOrder = function decorateOrderBookOrder(order) {\n  var orderType = order.tokenGive === ETHER_ADDRESS ? 'buy' : 'sell';\n  return _objectSpread(_objectSpread({}, order), {}, {\n    orderType: orderType,\n    orderTypeClass: orderType === 'buy' ? GREEN : RED,\n    orderFillAction: orderType === 'buy' ? 'sell' : 'buy'\n  });\n};\n\nexport var myFilledOrdersLoadedSelector = createSelector(filledOrdersLoaded, function (loaded) {\n  return loaded;\n});\nexport var myFilledOrdersSelector = createSelector(account, filledOrders, function (account, orders) {\n  // Find our orders\n  orders = orders.filter(function (o) {\n    return o.user === account || o.userFill === account;\n  }); // Sort by date ascending\n\n  orders = orders.sort(function (a, b) {\n    return a.timestamp - b.timestamp;\n  }); // Decorate orders - add display attributes\n\n  orders = decorateMyFilledOrders(orders, account);\n  return orders;\n});\n\nvar decorateMyFilledOrders = function decorateMyFilledOrders(orders, account) {\n  return orders.map(function (order) {\n    order = decorateOrder(order);\n    order = decorateMyFilledOrder(order, account);\n    return order;\n  });\n};\n\nvar decorateMyFilledOrder = function decorateMyFilledOrder(order, account) {\n  var myOrder = order.user === account;\n  var orderType;\n\n  if (myOrder) {\n    orderType = order.tokenGive === ETHER_ADDRESS ? 'buy' : 'sell';\n  } else {\n    orderType = order.tokenGive === ETHER_ADDRESS ? 'sell' : 'buy';\n  }\n\n  return _objectSpread(_objectSpread({}, order), {}, {\n    orderType: orderType,\n    orderTypeClass: orderType === 'buy' ? GREEN : RED,\n    orderSign: orderType === 'buy' ? '+' : '-'\n  });\n};\n\nexport var myOpenOrdersLoadedSelector = createSelector(orderBookLoaded, function (loaded) {\n  return loaded;\n});\nexport var myOpenOrdersSelector = createSelector(account, openOrders, function (account, orders) {\n  // Filter orders created by current account\n  orders = orders.filter(function (o) {\n    return o.user === account;\n  }); // Decorate orders - add display attributes\n\n  orders = decorateMyOpenOrders(orders); // Sort orders by date descending\n\n  orders = orders.sort(function (a, b) {\n    return b.timestamp - a.timestamp;\n  });\n  return orders;\n});\n\nvar decorateMyOpenOrders = function decorateMyOpenOrders(orders, account) {\n  return orders.map(function (order) {\n    order = decorateOrder(order);\n    order = decorateMyOpenOrder(order, account);\n    return order;\n  });\n};\n\nvar decorateMyOpenOrder = function decorateMyOpenOrder(order, account) {\n  var orderType = order.tokenGive === ETHER_ADDRESS ? 'buy' : 'sell';\n  return _objectSpread(_objectSpread({}, order), {}, {\n    orderType: orderType,\n    orderTypeClass: orderType === 'buy' ? GREEN : RED\n  });\n};\n\nexport var priceChartLoadedSelector = createSelector(filledOrdersLoaded, function (loaded) {\n  return loaded;\n});\nexport var priceChartSelector = createSelector(filledOrders, function (orders) {\n  // Sort orders by date ascending to compare history\n  orders = orders.sort(function (a, b) {\n    return a.timestamp - b.timestamp;\n  }); // Decorate orders - add display attributes\n\n  orders = orders.map(function (o) {\n    return decorateOrder(o);\n  }); // Get last 2 order for final price & price change\n\n  var secondLastOrder, lastOrder;\n\n  var _orders$slice = orders.slice(orders.length - 2, orders.length);\n\n  var _orders$slice2 = _slicedToArray(_orders$slice, 2);\n\n  secondLastOrder = _orders$slice2[0];\n  lastOrder = _orders$slice2[1];\n  // get last order price\n  var lastPrice = get(lastOrder, 'tokenPrice', 0); // get second last order price\n\n  var secondLastPrice = get(secondLastOrder, 'tokenPrice', 0);\n  return {\n    lastPrice: lastPrice,\n    lastPriceChange: lastPrice >= secondLastPrice ? '+' : '-',\n    series: [{\n      data: buildGraphData(orders)\n    }]\n  };\n});\n\nvar buildGraphData = function buildGraphData(orders) {\n  // Group the orders by hour for the graph\n  orders = groupBy(orders, function (o) {\n    return moment.unix(o.timestamp).startOf('hour').format();\n  }); // Get each hour where data exists\n\n  var hours = Object.keys(orders); // Build the graph series\n\n  var graphData = hours.map(function (hour) {\n    // Fetch all the orders from current hour\n    var group = orders[hour]; // Calculate price values - open, high, low, close\n\n    var open = group[0]; // first order\n\n    var high = maxBy(group, 'tokenPrice'); // high price\n\n    var low = minBy(group, 'tokenPrice'); // low price\n\n    var close = group[group.length - 1]; // last order\n\n    return {\n      x: new Date(hour),\n      y: [open.tokenPrice, high.tokenPrice, low.tokenPrice, close.tokenPrice]\n    };\n  });\n  return graphData;\n};\n\nvar orderCancelling = function orderCancelling(state) {\n  return get(state, 'exchange.orderCancelling', false);\n};\n\nexport var orderCancellingSelector = createSelector(orderCancelling, function (status) {\n  return status;\n});\n\nvar orderFilling = function orderFilling(state) {\n  return get(state, 'exchange.orderFilling', false);\n};\n\nexport var orderFillingSelector = createSelector(orderFilling, function (status) {\n  return status;\n});\n\nvar balancesLoading = function balancesLoading(state) {\n  return get(state, 'exchange.balancesLoading', true);\n};\n\nexport var balancesLoadingSelector = createSelector(balancesLoading, function (status) {\n  return status;\n});\n\nvar etherBalance = function etherBalance(state) {\n  return get(state, 'web3.balance', 0);\n};\n\nexport var etherBalanceSelector = createSelector(etherBalance, function (balance) {\n  return formatBalance(balance);\n});\n\nvar tokenBalance = function tokenBalance(state) {\n  return get(state, 'token.balance', 0);\n};\n\nexport var tokenBalanceSelector = createSelector(tokenBalance, function (balance) {\n  return formatBalance(balance);\n});\n\nvar exchangeEtherBalance = function exchangeEtherBalance(state) {\n  return get(state, 'exchange.etherBalance', 0);\n};\n\nexport var exchangeEtherBalanceSelector = createSelector(exchangeEtherBalance, function (balance) {\n  return formatBalance(balance);\n});\n\nvar exchangeTokenBalance = function exchangeTokenBalance(state) {\n  return get(state, 'exchange.tokenBalance', 0);\n};\n\nexport var exchangeTokenBalanceSelector = createSelector(exchangeTokenBalance, function (balance) {\n  return formatBalance(balance);\n});\n\nvar etherDepositAmount = function etherDepositAmount(state) {\n  return get(state, 'exchange.etherDepositAmount', null);\n};\n\nexport var etherDepositAmountSelector = createSelector(etherDepositAmount, function (amount) {\n  return amount;\n});\n\nvar etherWithdrawAmount = function etherWithdrawAmount(state) {\n  return get(state, 'exchange.etherWithdrawAmount', null);\n};\n\nexport var etherWithdrawAmountSelector = createSelector(etherWithdrawAmount, function (amount) {\n  return amount;\n});\n\nvar tokenDepositAmount = function tokenDepositAmount(state) {\n  return get(state, 'exchange.tokenDepositAmount', null);\n};\n\nexport var tokenDepositAmountSelector = createSelector(tokenDepositAmount, function (amount) {\n  return amount;\n});\n\nvar tokenWithdrawAmount = function tokenWithdrawAmount(state) {\n  return get(state, 'exchange.tokenWithdrawAmount', null);\n};\n\nexport var tokenWithdrawAmountSelector = createSelector(tokenWithdrawAmount, function (amount) {\n  return amount;\n});","map":{"version":3,"sources":["/Users/raymondburgess/Dapps/blockchain-developer-bootcamp-v2/src/store/selectors.js"],"names":["get","groupBy","reject","maxBy","minBy","createSelector","moment","ETHER_ADDRESS","GREEN","RED","tokens","ether","formatBalance","account","state","accountSelector","a","web3","web3Selector","w","tokenLoaded","tokenLoadedSelector","tl","token","tokenSelector","t","exchangeLoaded","exchangeLoadedSelector","el","exchange","exchangeSelector","e","contractsLoadedSelector","allOrdersLoaded","allOrders","cancelledOrdersLoaded","cancelledOrdersLoadedSelector","loaded","cancelledOrders","cancelledOrdersSelector","o","filledOrdersLoaded","filledOrdersLoadedSelector","filledOrders","filledOrdersSelector","orders","sort","b","timestamp","decorateFilledOrders","previousOrder","map","order","decorateOrder","decorateFilledOrder","etherAmount","tokenAmount","tokenGive","amountGive","amountGet","precision","tokenPrice","Math","round","formattedTimestamp","unix","format","tokenPriceClass","id","orderId","openOrders","all","filled","cancelled","orderFilled","some","orderCancelled","orderBookLoaded","orderBookLoadedSelector","orderBookSelector","decorateOrderBookOrders","buyOrders","sellOrders","decorateOrderBookOrder","orderType","orderTypeClass","orderFillAction","myFilledOrdersLoadedSelector","myFilledOrdersSelector","filter","user","userFill","decorateMyFilledOrders","decorateMyFilledOrder","myOrder","orderSign","myOpenOrdersLoadedSelector","myOpenOrdersSelector","decorateMyOpenOrders","decorateMyOpenOrder","priceChartLoadedSelector","priceChartSelector","secondLastOrder","lastOrder","slice","length","lastPrice","secondLastPrice","lastPriceChange","series","data","buildGraphData","startOf","hours","Object","keys","graphData","hour","group","open","high","low","close","x","Date","y","orderCancelling","orderCancellingSelector","status","orderFilling","orderFillingSelector","balancesLoading","balancesLoadingSelector","etherBalance","etherBalanceSelector","balance","tokenBalance","tokenBalanceSelector","exchangeEtherBalance","exchangeEtherBalanceSelector","exchangeTokenBalance","exchangeTokenBalanceSelector","etherDepositAmount","etherDepositAmountSelector","amount","etherWithdrawAmount","etherWithdrawAmountSelector","tokenDepositAmount","tokenDepositAmountSelector","tokenWithdrawAmount","tokenWithdrawAmountSelector"],"mappings":"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","sourcesContent":["import { get, groupBy, reject, maxBy, minBy } from 'lodash'\nimport { createSelector } from 'reselect'\nimport moment from 'moment'\nimport { ETHER_ADDRESS, GREEN, RED, tokens, ether, formatBalance } from '../helpers'\n\nconst account = state => get(state, 'web3.account')\nexport const accountSelector = createSelector(account, a => a)\n\nconst web3 = state => get(state, 'web3.connection')\nexport const web3Selector = createSelector(web3, w => w)\n\nconst tokenLoaded = state => get(state, 'token.loaded', false)\nexport const tokenLoadedSelector = createSelector(tokenLoaded, tl => tl)\n\nconst token = state => get(state, 'token.connection')\nexport const tokenSelector = createSelector(token, t => t)\n\nconst exchangeLoaded = state => get(state, 'exchange.loaded', false)\nexport const exchangeLoadedSelector = createSelector(exchangeLoaded, el => el)\n\nconst exchange = state => get(state, 'exchange.connection')\nexport const exchangeSelector = createSelector(exchange, e => e)\n\nexport const contractsLoadedSelector = createSelector(\n  tokenLoaded,\n  exchangeLoaded,\n  (tl, el) => (tl && el)\n)\n\n// All Orders\nconst allOrdersLoaded = state => get(state, 'exchange.allOrders.loaded', false)\nconst allOrders = state => get(state, 'exchange.allOrders.data', [])\n\n// Cancelled orders\nconst cancelledOrdersLoaded = state => get(state, 'exchange.cancelledOrders.loaded', false)\nexport const cancelledOrdersLoadedSelector = createSelector(cancelledOrdersLoaded, loaded => loaded)\n\nconst cancelledOrders = state => get(state, 'exchange.cancelledOrders.data', [])\nexport const cancelledOrdersSelector = createSelector(cancelledOrders, o => o)\n\n// Filled Orders\nconst filledOrdersLoaded = state => get(state, 'exchange.filledOrders.loaded', false)\nexport const filledOrdersLoadedSelector = createSelector(filledOrdersLoaded, loaded => loaded)\n\nconst filledOrders = state => get(state, 'exchange.filledOrders.data', [])\nexport const filledOrdersSelector = createSelector(\n  filledOrders,\n  (orders) => {\n    // Sort orders by date ascending for price comparison\n    orders = orders.sort((a,b) => a.timestamp - b.timestamp)\n    // Decorate the orders\n    orders = decorateFilledOrders(orders)\n    // Sort orders by date descending for display\n    orders = orders.sort((a,b) => b.timestamp - a.timestamp)\n    return orders\n  }\n)\n\nconst decorateFilledOrders = (orders) => {\n  // Track previous order to compare history\n  let previousOrder = orders[0]\n  return(\n    orders.map((order) => {\n      order = decorateOrder(order)\n      order = decorateFilledOrder(order, previousOrder)\n      previousOrder = order // Update the previous order once it's decorated\n      return order\n    })\n  )\n}\n\nconst decorateOrder = (order) => {\n  let etherAmount\n  let tokenAmount\n\n  if(order.tokenGive === ETHER_ADDRESS) {\n    etherAmount = order.amountGive\n    tokenAmount = order.amountGet\n  } else {\n    etherAmount = order.amountGet\n    tokenAmount = order.amountGive\n  }\n\n  // Calculate token price to 5 decimal places\n  const precision = 100000\n  let tokenPrice = (etherAmount / tokenAmount)\n  tokenPrice = Math.round(tokenPrice * precision) / precision\n\n  return({\n    ...order,\n    etherAmount: ether(etherAmount),\n    tokenAmount: tokens(tokenAmount),\n    tokenPrice,\n    formattedTimestamp: moment.unix(order.timestamp).format('h:mm:ss a M/D')\n  })\n}\n\nconst decorateFilledOrder = (order, previousOrder) => {\n  return({\n    ...order,\n    tokenPriceClass: tokenPriceClass(order.tokenPrice, order.id, previousOrder)\n  })\n}\n\nconst tokenPriceClass = (tokenPrice, orderId, previousOrder) => {\n  // Show green price if only one order exists\n  if(previousOrder.id === orderId) {\n    return GREEN\n  }\n\n  // Show green price if order price higher than previous order\n  // Show red price if order price lower than previous order\n  if(previousOrder.tokenPrice <= tokenPrice) {\n    return GREEN // success\n  } else {\n    return RED // danger\n  }\n}\n\nconst openOrders = state => {\n  const all = allOrders(state)\n  const filled = filledOrders(state)\n  const cancelled = cancelledOrders(state)\n\n  const openOrders = reject(all, (order) => {\n    const orderFilled = filled.some((o) => o.id === order.id)\n    const orderCancelled = cancelled.some((o) => o.id === order.id)\n    return(orderFilled || orderCancelled)\n  })\n\n  return openOrders\n}\n\n\nconst orderBookLoaded = state => cancelledOrdersLoaded(state) && filledOrdersLoaded(state) && allOrdersLoaded(state)\nexport const orderBookLoadedSelector = createSelector(orderBookLoaded, loaded => loaded)\n\n// Create the order book\nexport const orderBookSelector = createSelector(\n  openOrders,\n  (orders) => {\n    // Decorate orders\n    orders = decorateOrderBookOrders(orders)\n    // Group orders by \"orderType\"\n    orders = groupBy(orders, 'orderType')\n    // Fetch buy orders\n    const buyOrders = get(orders, 'buy', [])\n    // Sort buy orders by token price\n    orders = {\n      ...orders,\n      buyOrders: buyOrders.sort((a,b) => b.tokenPrice - a.tokenPrice)\n    }\n    // Fetch sell orders\n    const sellOrders = get(orders, 'sell', [])\n    // Sort sell orders by token price\n    orders = {\n      ...orders,\n      sellOrders: sellOrders.sort((a,b) => b.tokenPrice - a.tokenPrice)\n    }\n    return orders\n  }\n)\n\nconst decorateOrderBookOrders = (orders) => {\n  return(\n    orders.map((order) => {\n      order = decorateOrder(order)\n      order = decorateOrderBookOrder(order)\n      return(order)\n    })\n  )\n}\n\nconst decorateOrderBookOrder = (order) => {\n  const orderType = order.tokenGive === ETHER_ADDRESS ? 'buy' : 'sell'\n  return({\n    ...order,\n    orderType,\n    orderTypeClass: (orderType === 'buy' ? GREEN : RED),\n    orderFillAction: orderType === 'buy' ? 'sell' : 'buy'\n  })\n}\n\nexport const myFilledOrdersLoadedSelector = createSelector(filledOrdersLoaded, loaded => loaded)\n\nexport const myFilledOrdersSelector = createSelector(\n  account,\n  filledOrders,\n  (account, orders) => {\n    // Find our orders\n    orders = orders.filter((o) => o.user === account || o.userFill === account)\n    // Sort by date ascending\n    orders = orders.sort((a,b) => a.timestamp - b.timestamp)\n    // Decorate orders - add display attributes\n    orders = decorateMyFilledOrders(orders, account)\n    return orders\n  }\n)\n\nconst decorateMyFilledOrders = (orders, account) => {\n  return(\n    orders.map((order) => {\n      order = decorateOrder(order)\n      order = decorateMyFilledOrder(order, account)\n      return(order)\n    })\n  )\n}\n\nconst decorateMyFilledOrder = (order, account) => {\n  const myOrder = order.user === account\n\n  let orderType\n  if(myOrder) {\n    orderType = order.tokenGive === ETHER_ADDRESS ? 'buy' : 'sell'\n  } else {\n    orderType = order.tokenGive === ETHER_ADDRESS ? 'sell' : 'buy'\n  }\n\n  return({\n    ...order,\n    orderType,\n    orderTypeClass: (orderType === 'buy' ? GREEN : RED),\n    orderSign: (orderType === 'buy' ? '+' : '-')\n  })\n}\n\nexport const myOpenOrdersLoadedSelector = createSelector(orderBookLoaded, loaded => loaded)\n\nexport const myOpenOrdersSelector = createSelector(\n  account,\n  openOrders,\n  (account, orders) => {\n    // Filter orders created by current account\n    orders = orders.filter((o) => o.user === account)\n    // Decorate orders - add display attributes\n    orders = decorateMyOpenOrders(orders)\n    // Sort orders by date descending\n    orders = orders.sort((a,b) => b.timestamp - a.timestamp)\n    return orders\n  }\n)\n\nconst decorateMyOpenOrders = (orders, account) => {\n  return(\n    orders.map((order) => {\n      order = decorateOrder(order)\n      order = decorateMyOpenOrder(order, account)\n      return(order)\n    })\n  )\n}\n\nconst decorateMyOpenOrder = (order, account) => {\n  let orderType = order.tokenGive === ETHER_ADDRESS ? 'buy' : 'sell'\n\n  return({\n    ...order,\n    orderType,\n    orderTypeClass: (orderType === 'buy' ? GREEN : RED)\n  })\n}\n\nexport const priceChartLoadedSelector = createSelector(filledOrdersLoaded, loaded => loaded)\n\nexport const priceChartSelector = createSelector(\n  filledOrders,\n  (orders) => {\n    // Sort orders by date ascending to compare history\n    orders = orders.sort((a,b) => a.timestamp - b.timestamp)\n    // Decorate orders - add display attributes\n    orders = orders.map((o) => decorateOrder(o))\n    // Get last 2 order for final price & price change\n    let secondLastOrder, lastOrder\n    [secondLastOrder, lastOrder] = orders.slice(orders.length - 2, orders.length)\n    // get last order price\n    const lastPrice = get(lastOrder, 'tokenPrice', 0)\n    // get second last order price\n    const secondLastPrice = get(secondLastOrder, 'tokenPrice', 0)\n\n    return({\n      lastPrice,\n      lastPriceChange: (lastPrice >= secondLastPrice ? '+' : '-'),\n      series: [{\n        data: buildGraphData(orders)\n      }]\n    })\n  }\n)\n\nconst buildGraphData = (orders) => {\n  // Group the orders by hour for the graph\n  orders = groupBy(orders, (o) => moment.unix(o.timestamp).startOf('hour').format())\n  // Get each hour where data exists\n  const hours = Object.keys(orders)\n  // Build the graph series\n  const graphData = hours.map((hour) => {\n    // Fetch all the orders from current hour\n    const group = orders[hour]\n    // Calculate price values - open, high, low, close\n    const open = group[0] // first order\n    const high = maxBy(group, 'tokenPrice') // high price\n    const low = minBy(group, 'tokenPrice') // low price\n    const close = group[group.length - 1] // last order\n\n    return({\n      x: new Date(hour),\n      y: [open.tokenPrice, high.tokenPrice, low.tokenPrice, close.tokenPrice]\n    })\n  })\n\n  return graphData\n}\n\nconst orderCancelling = state => get(state, 'exchange.orderCancelling', false)\nexport const orderCancellingSelector = createSelector(orderCancelling, status => status)\n\nconst orderFilling = state => get(state, 'exchange.orderFilling', false)\nexport const orderFillingSelector = createSelector(orderFilling, status => status)\n\nconst balancesLoading = state => get(state, 'exchange.balancesLoading', true)\nexport const balancesLoadingSelector = createSelector(balancesLoading, status => status)\n\nconst etherBalance = state => get(state, 'web3.balance', 0)\nexport const etherBalanceSelector = createSelector(\n  etherBalance,\n  (balance) => {\n    return formatBalance(balance)\n  }\n)\n\nconst tokenBalance = state => get(state, 'token.balance', 0)\nexport const tokenBalanceSelector = createSelector(\n  tokenBalance,\n  (balance) => {\n    return formatBalance(balance)\n  }\n)\n\nconst exchangeEtherBalance = state => get(state, 'exchange.etherBalance', 0)\nexport const exchangeEtherBalanceSelector = createSelector(\n  exchangeEtherBalance,\n  (balance) => {\n    return formatBalance(balance)\n  }\n)\n\nconst exchangeTokenBalance = state => get(state, 'exchange.tokenBalance', 0)\nexport const exchangeTokenBalanceSelector = createSelector(\n  exchangeTokenBalance,\n  (balance) => {\n    return formatBalance(balance)\n  }\n)\n\nconst etherDepositAmount = state => get(state, 'exchange.etherDepositAmount', null)\nexport const etherDepositAmountSelector = createSelector(etherDepositAmount, amount => amount)\n\nconst etherWithdrawAmount = state => get(state, 'exchange.etherWithdrawAmount', null)\nexport const etherWithdrawAmountSelector = createSelector(etherWithdrawAmount, amount => amount)\n\nconst tokenDepositAmount = state => get(state, 'exchange.tokenDepositAmount', null)\nexport const tokenDepositAmountSelector = createSelector(tokenDepositAmount, amount => amount)\n\nconst tokenWithdrawAmount = state => get(state, 'exchange.tokenWithdrawAmount', null)\nexport const tokenWithdrawAmountSelector = createSelector(tokenWithdrawAmount, amount => amount)\n\n"]},"metadata":{},"sourceType":"module"}