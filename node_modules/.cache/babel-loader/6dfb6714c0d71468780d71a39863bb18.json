{"ast":null,"code":"import _regeneratorRuntime from\"/Users/raymondburgess/Dapps/blockchain-developer-bootcamp-v2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/raymondburgess/Dapps/blockchain-developer-bootcamp-v2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import Web3 from'web3';import{web3Loaded,web3AccountLoaded,tokenLoaded,exchangeLoaded,cancelledOrdersLoaded,filledOrdersLoaded,allOrdersLoaded,orderCancelling,orderCancelled,orderFilling,orderFilled,etherBalanceLoaded,tokenBalanceLoaded,exchangeEtherBalanceLoaded,exchangeTokenBalanceLoaded,balancesLoaded,balancesLoading,buyOrderMaking,sellOrderMaking,orderMade}from'./actions';import Token from'../abis/Token.json';import Exchange from'../abis/Exchange.json';import{ETHER_ADDRESS}from'../helpers';export var loadWeb3=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var web3;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(typeof window.ethereum!=='undefined')){_context.next=6;break;}web3=new Web3(window.ethereum);dispatch(web3Loaded(web3));return _context.abrupt(\"return\",web3);case 6:window.alert('Please install MetaMask');window.location.assign(\"https://metamask.io/\");case 8:case\"end\":return _context.stop();}}},_callee);}));return function loadWeb3(_x){return _ref.apply(this,arguments);};}();export var loadAccount=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(web3,dispatch){var accounts,account;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return web3.eth.requestAccounts();case 2:accounts=_context2.sent;_context2.next=5;return accounts[0];case 5:account=_context2.sent;if(!(typeof account!=='undefined')){_context2.next=11;break;}dispatch(web3AccountLoaded(account));return _context2.abrupt(\"return\",account);case 11:window.alert('Please login with MetaMask');return _context2.abrupt(\"return\",null);case 13:case\"end\":return _context2.stop();}}},_callee2);}));return function loadAccount(_x2,_x3){return _ref2.apply(this,arguments);};}();export var loadToken=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(web3,networkId,dispatch){var token;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;token=new web3.eth.Contract(Token.abi,Token.networks[networkId].address);dispatch(tokenLoaded(token));return _context3.abrupt(\"return\",token);case 6:_context3.prev=6;_context3.t0=_context3[\"catch\"](0);console.log('Contract not deployed to the current network. Please select another network with Metamask.');return _context3.abrupt(\"return\",null);case 10:case\"end\":return _context3.stop();}}},_callee3,null,[[0,6]]);}));return function loadToken(_x4,_x5,_x6){return _ref3.apply(this,arguments);};}();export var loadExchange=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(web3,networkId,dispatch){var exchange;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;exchange=new web3.eth.Contract(Exchange.abi,Exchange.networks[networkId].address);dispatch(exchangeLoaded(exchange));return _context4.abrupt(\"return\",exchange);case 6:_context4.prev=6;_context4.t0=_context4[\"catch\"](0);console.log('Contract not deployed to the current network. Please select another network with Metamask.');return _context4.abrupt(\"return\",null);case 10:case\"end\":return _context4.stop();}}},_callee4,null,[[0,6]]);}));return function loadExchange(_x7,_x8,_x9){return _ref4.apply(this,arguments);};}();export var loadAllOrders=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(exchange,dispatch){var cancelStream,cancelledOrders,tradeStream,filledOrders,orderStream,allOrders;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return exchange.getPastEvents('Cancel',{fromBlock:0,toBlock:'latest'});case 2:cancelStream=_context5.sent;// Format cancelled orders\ncancelledOrders=cancelStream.map(function(event){return event.returnValues;});// Add cancelled orders to the redux store\ndispatch(cancelledOrdersLoaded(cancelledOrders));// Fetch filled orders with the \"Trade\" event stream\n_context5.next=7;return exchange.getPastEvents('Trade',{fromBlock:0,toBlock:'latest'});case 7:tradeStream=_context5.sent;// Format filled orders\nfilledOrders=tradeStream.map(function(event){return event.returnValues;});// Add cancelled orders to the redux store\ndispatch(filledOrdersLoaded(filledOrders));// Load order stream\n_context5.next=12;return exchange.getPastEvents('Order',{fromBlock:0,toBlock:'latest'});case 12:orderStream=_context5.sent;// Format order stream\nallOrders=orderStream.map(function(event){return event.returnValues;});// Add open orders to the redux store\ndispatch(allOrdersLoaded(allOrders));case 15:case\"end\":return _context5.stop();}}},_callee5);}));return function loadAllOrders(_x10,_x11){return _ref5.apply(this,arguments);};}();export var cancelOrder=function cancelOrder(dispatch,exchange,order,account){exchange.methods.cancelOrder(order.id).send({from:account}).on('transactionHash',function(hash){dispatch(orderCancelling());}).on('error',function(error){console.log(error);window.alert('There was an error!');});};export var subscribeToEvents=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(exchange,dispatch){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:exchange.events.Cancel({},function(error,event){dispatch(orderCancelled(event.returnValues));});exchange.events.Trade({},function(error,event){dispatch(orderFilled(event.returnValues));});exchange.events.Deposit({},function(error,event){dispatch(balancesLoaded());});exchange.events.Withdraw({},function(error,event){dispatch(balancesLoaded());});exchange.events.Order({},function(error,event){dispatch(orderMade(event.returnValues));});case 5:case\"end\":return _context6.stop();}}},_callee6);}));return function subscribeToEvents(_x12,_x13){return _ref6.apply(this,arguments);};}();export var fillOrder=function fillOrder(dispatch,exchange,order,account){exchange.methods.fillOrder(order.id).send({from:account}).on('transactionHash',function(hash){dispatch(orderFilling());}).on('error',function(error){console.log(error);window.alert('There was an error!');});};export var loadBalances=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(dispatch,web3,exchange,token,account){var etherBalance,tokenBalance,exchangeEtherBalance,exchangeTokenBalance;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if(!(typeof account!=='undefined')){_context7.next=20;break;}_context7.next=3;return web3.eth.getBalance(account);case 3:etherBalance=_context7.sent;dispatch(etherBalanceLoaded(etherBalance));// Token balance in wallet\n_context7.next=7;return token.methods.balanceOf(account).call();case 7:tokenBalance=_context7.sent;dispatch(tokenBalanceLoaded(tokenBalance));// Ether balance in exchange\n_context7.next=11;return exchange.methods.balanceOf(ETHER_ADDRESS,account).call();case 11:exchangeEtherBalance=_context7.sent;dispatch(exchangeEtherBalanceLoaded(exchangeEtherBalance));// Token balance in exchange\n_context7.next=15;return exchange.methods.balanceOf(token.options.address,account).call();case 15:exchangeTokenBalance=_context7.sent;dispatch(exchangeTokenBalanceLoaded(exchangeTokenBalance));// Trigger all balances loaded\ndispatch(balancesLoaded());_context7.next=21;break;case 20:window.alert('Please login with MetaMask');case 21:case\"end\":return _context7.stop();}}},_callee7);}));return function loadBalances(_x14,_x15,_x16,_x17,_x18){return _ref7.apply(this,arguments);};}();export var depositEther=function depositEther(dispatch,exchange,web3,amount,account){exchange.methods.depositEther().send({from:account,value:web3.utils.toWei(amount,'ether')}).on('transactionHash',function(hash){dispatch(balancesLoading());}).on('error',function(error){console.error(error);window.alert(\"There was an error!\");});};export var withdrawEther=function withdrawEther(dispatch,exchange,web3,amount,account){exchange.methods.withdrawEther(web3.utils.toWei(amount,'ether')).send({from:account}).on('transactionHash',function(hash){dispatch(balancesLoading());}).on('error',function(error){console.error(error);window.alert(\"There was an error!\");});};export var depositToken=function depositToken(dispatch,exchange,web3,token,amount,account){amount=web3.utils.toWei(amount,'ether');token.methods.approve(exchange.options.address,amount).send({from:account}).on('transactionHash',function(hash){exchange.methods.depositToken(token.options.address,amount).send({from:account}).on('transactionHash',function(hash){dispatch(balancesLoading());}).on('error',function(error){console.error(error);window.alert(\"There was an error!\");});});};export var withdrawToken=function withdrawToken(dispatch,exchange,web3,token,amount,account){exchange.methods.withdrawToken(token.options.address,web3.utils.toWei(amount,'ether')).send({from:account}).on('transactionHash',function(hash){dispatch(balancesLoading());}).on('error',function(error){console.error(error);window.alert(\"There was an error!\");});};export var makeBuyOrder=function makeBuyOrder(dispatch,exchange,token,web3,order,account){var tokenGet=token.options.address;var amountGet=web3.utils.toWei(order.amount,'ether');var tokenGive=ETHER_ADDRESS;var amountGive=web3.utils.toWei((order.amount*order.price).toString(),'ether');exchange.methods.makeOrder(tokenGet,amountGet,tokenGive,amountGive).send({from:account}).on('transactionHash',function(hash){dispatch(buyOrderMaking());}).on('error',function(error){console.error(error);window.alert(\"There was an error!\");});};export var makeSellOrder=function makeSellOrder(dispatch,exchange,token,web3,order,account){var tokenGet=ETHER_ADDRESS;var amountGet=web3.utils.toWei((order.amount*order.price).toString(),'ether');var tokenGive=token.options.address;var amountGive=web3.utils.toWei(order.amount,'ether');exchange.methods.makeOrder(tokenGet,amountGet,tokenGive,amountGive).send({from:account}).on('transactionHash',function(hash){dispatch(sellOrderMaking());}).on('error',function(error){console.error(error);window.alert(\"There was an error!\");});};","map":{"version":3,"sources":["/Users/raymondburgess/Dapps/blockchain-developer-bootcamp-v2/src/store/interactions.js"],"names":["Web3","web3Loaded","web3AccountLoaded","tokenLoaded","exchangeLoaded","cancelledOrdersLoaded","filledOrdersLoaded","allOrdersLoaded","orderCancelling","orderCancelled","orderFilling","orderFilled","etherBalanceLoaded","tokenBalanceLoaded","exchangeEtherBalanceLoaded","exchangeTokenBalanceLoaded","balancesLoaded","balancesLoading","buyOrderMaking","sellOrderMaking","orderMade","Token","Exchange","ETHER_ADDRESS","loadWeb3","dispatch","window","ethereum","web3","alert","location","assign","loadAccount","eth","requestAccounts","accounts","account","loadToken","networkId","token","Contract","abi","networks","address","console","log","loadExchange","exchange","loadAllOrders","getPastEvents","fromBlock","toBlock","cancelStream","cancelledOrders","map","event","returnValues","tradeStream","filledOrders","orderStream","allOrders","cancelOrder","order","methods","id","send","from","on","hash","error","subscribeToEvents","events","Cancel","Trade","Deposit","Withdraw","Order","fillOrder","loadBalances","getBalance","etherBalance","balanceOf","call","tokenBalance","exchangeEtherBalance","options","exchangeTokenBalance","depositEther","amount","value","utils","toWei","withdrawEther","depositToken","approve","withdrawToken","makeBuyOrder","tokenGet","amountGet","tokenGive","amountGive","price","toString","makeOrder","makeSellOrder"],"mappings":"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","sourcesContent":["import Web3 from 'web3'\n\nimport {\n  web3Loaded,\n  web3AccountLoaded,\n  tokenLoaded,\n  exchangeLoaded,\n  cancelledOrdersLoaded,\n  filledOrdersLoaded,\n  allOrdersLoaded,\n  orderCancelling,\n  orderCancelled,\n  orderFilling,\n  orderFilled,\n  etherBalanceLoaded,\n  tokenBalanceLoaded,\n  exchangeEtherBalanceLoaded,\n  exchangeTokenBalanceLoaded,\n  balancesLoaded,\n  balancesLoading,\n  buyOrderMaking,\n  sellOrderMaking,\n  orderMade\n} from './actions'\nimport Token from '../abis/Token.json'\nimport Exchange from '../abis/Exchange.json'\nimport { ETHER_ADDRESS } from '../helpers'\n\nexport const loadWeb3 = async (dispatch) => {\n  if(typeof window.ethereum!=='undefined'){\n    const web3 = new Web3(window.ethereum)\n    dispatch(web3Loaded(web3))\n    return web3\n  } else {\n    window.alert('Please install MetaMask')\n    window.location.assign(\"https://metamask.io/\")\n  }\n}\n\nexport const loadAccount = async (web3, dispatch) => {\n  const accounts = await web3.eth.requestAccounts()\n  const account = await accounts[0]\n  if(typeof account !== 'undefined'){\n    dispatch(web3AccountLoaded(account))\n    return account\n  } else {\n    window.alert('Please login with MetaMask')\n    return null\n  }\n}\n\nexport const loadToken = async (web3, networkId, dispatch) => {\n  try {\n    const token = new web3.eth.Contract(Token.abi, Token.networks[networkId].address)\n    dispatch(tokenLoaded(token))\n    return token\n  } catch (error) {\n    console.log('Contract not deployed to the current network. Please select another network with Metamask.')\n    return null\n  }\n}\n\nexport const loadExchange = async (web3, networkId, dispatch) => {\n  try {\n    const exchange = new web3.eth.Contract(Exchange.abi, Exchange.networks[networkId].address)\n    dispatch(exchangeLoaded(exchange))\n    return exchange\n  } catch (error) {\n    console.log('Contract not deployed to the current network. Please select another network with Metamask.')\n    return null\n  }\n}\n\nexport const loadAllOrders = async (exchange, dispatch) => {\n  // Fetch cancelled orders with the \"Cancel\" event stream\n  const cancelStream = await exchange.getPastEvents('Cancel', { fromBlock: 0, toBlock: 'latest' })\n  // Format cancelled orders\n  const cancelledOrders = cancelStream.map((event) => event.returnValues)\n  // Add cancelled orders to the redux store\n  dispatch(cancelledOrdersLoaded(cancelledOrders))\n\n  // Fetch filled orders with the \"Trade\" event stream\n  const tradeStream = await exchange.getPastEvents('Trade', { fromBlock: 0, toBlock: 'latest' })\n  // Format filled orders\n  const filledOrders = tradeStream.map((event) => event.returnValues)\n  // Add cancelled orders to the redux store\n  dispatch(filledOrdersLoaded(filledOrders))\n\n  // Load order stream\n  const orderStream = await exchange.getPastEvents('Order', { fromBlock: 0,  toBlock: 'latest' })\n  // Format order stream\n  const allOrders = orderStream.map((event) => event.returnValues)\n  // Add open orders to the redux store\n  dispatch(allOrdersLoaded(allOrders))\n}\n\nexport const cancelOrder = (dispatch, exchange, order, account) => {\n  exchange.methods.cancelOrder(order.id).send({ from: account })\n  .on('transactionHash', (hash) => {\n     dispatch(orderCancelling())\n  })\n  .on('error', (error) => {\n    console.log(error)\n    window.alert('There was an error!')\n  })\n}\n\nexport const subscribeToEvents = async (exchange, dispatch) => {\n  exchange.events.Cancel({}, (error, event) => {\n    dispatch(orderCancelled(event.returnValues))\n  })\n\n  exchange.events.Trade({}, (error, event) => {\n    dispatch(orderFilled(event.returnValues))\n  })\n\n  exchange.events.Deposit({}, (error, event) => {\n    dispatch(balancesLoaded())\n  })\n\n  exchange.events.Withdraw({}, (error, event) => {\n    dispatch(balancesLoaded())\n  })\n\n  exchange.events.Order({}, (error, event) => {\n    dispatch(orderMade(event.returnValues))\n  })\n}\n\nexport const fillOrder = (dispatch, exchange, order, account) => {\n  exchange.methods.fillOrder(order.id).send({ from: account })\n  .on('transactionHash', (hash) => {\n     dispatch(orderFilling())\n  })\n  .on('error', (error) => {\n    console.log(error)\n    window.alert('There was an error!')\n  })\n}\n\nexport const loadBalances = async (dispatch, web3, exchange, token, account) => {\n  if(typeof account !== 'undefined') {\n      // Ether balance in wallet\n      const etherBalance = await web3.eth.getBalance(account)\n      dispatch(etherBalanceLoaded(etherBalance))\n\n      // Token balance in wallet\n      const tokenBalance = await token.methods.balanceOf(account).call()\n      dispatch(tokenBalanceLoaded(tokenBalance))\n\n      // Ether balance in exchange\n      const exchangeEtherBalance = await exchange.methods.balanceOf(ETHER_ADDRESS, account).call()\n      dispatch(exchangeEtherBalanceLoaded(exchangeEtherBalance))\n\n      // Token balance in exchange\n      const exchangeTokenBalance = await exchange.methods.balanceOf(token.options.address, account).call()\n      dispatch(exchangeTokenBalanceLoaded(exchangeTokenBalance))\n\n      // Trigger all balances loaded\n      dispatch(balancesLoaded())\n    } else {\n      window.alert('Please login with MetaMask')\n    }\n}\n\nexport const depositEther = (dispatch, exchange, web3, amount, account) => {\n  exchange.methods.depositEther().send({ from: account,  value: web3.utils.toWei(amount, 'ether') })\n  .on('transactionHash', (hash) => {\n    dispatch(balancesLoading())\n  })\n  .on('error',(error) => {\n    console.error(error)\n    window.alert(`There was an error!`)\n  })\n}\n\nexport const withdrawEther = (dispatch, exchange, web3, amount, account) => {\n  exchange.methods.withdrawEther(web3.utils.toWei(amount, 'ether')).send({ from: account })\n  .on('transactionHash', (hash) => {\n    dispatch(balancesLoading())\n  })\n  .on('error',(error) => {\n    console.error(error)\n    window.alert(`There was an error!`)\n  })\n}\n\nexport const depositToken = (dispatch, exchange, web3, token, amount, account) => {\n  amount = web3.utils.toWei(amount, 'ether')\n\n  token.methods.approve(exchange.options.address, amount).send({ from: account })\n  .on('transactionHash', (hash) => {\n    exchange.methods.depositToken(token.options.address, amount).send({ from: account })\n    .on('transactionHash', (hash) => {\n      dispatch(balancesLoading())\n    })\n    .on('error',(error) => {\n      console.error(error)\n      window.alert(`There was an error!`)\n    })\n  })\n}\n\nexport const withdrawToken = (dispatch, exchange, web3, token, amount, account) => {\n  exchange.methods.withdrawToken(token.options.address, web3.utils.toWei(amount, 'ether')).send({ from: account })\n  .on('transactionHash', (hash) => {\n    dispatch(balancesLoading())\n  })\n  .on('error',(error) => {\n    console.error(error)\n    window.alert(`There was an error!`)\n  })\n}\n\nexport const makeBuyOrder = (dispatch, exchange, token, web3, order, account) => {\n  const tokenGet = token.options.address\n  const amountGet = web3.utils.toWei(order.amount, 'ether')\n  const tokenGive = ETHER_ADDRESS\n  const amountGive = web3.utils.toWei((order.amount * order.price).toString(), 'ether')\n\n  exchange.methods.makeOrder(tokenGet, amountGet, tokenGive, amountGive).send({ from: account })\n  .on('transactionHash', (hash) => {\n    dispatch(buyOrderMaking())\n  })\n  .on('error',(error) => {\n    console.error(error)\n    window.alert(`There was an error!`)\n  })\n}\n\nexport const makeSellOrder = (dispatch, exchange, token, web3, order, account) => {\n  const tokenGet = ETHER_ADDRESS\n  const amountGet = web3.utils.toWei((order.amount * order.price).toString(), 'ether')\n  const tokenGive = token.options.address\n  const amountGive = web3.utils.toWei(order.amount, 'ether')\n\n  exchange.methods.makeOrder(tokenGet, amountGet, tokenGive, amountGive).send({ from: account })\n  .on('transactionHash', (hash) => {\n    dispatch(sellOrderMaking())\n  })\n  .on('error',(error) => {\n    console.error(error)\n    window.alert(`There was an error!`)\n  })\n}\n\n"]},"metadata":{},"sourceType":"module"}